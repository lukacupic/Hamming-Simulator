<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script>
function hamming_coder_canvas(canvasID) {
  var canvas = document.getElementById(canvasID);
  var context = canvas.getContext('2d');

  function drawRect(x, y, w, h, symbol, negate) {
    context.rect(x - 0.5, y - 0.5, w, h);
    context.strokeStyle = "black";
    context.stroke();

    context.textAlign="center";
    context.textBaseline = "middle";
    context.font = "15px Calibri";
    context.fillText(symbol, (x * 2 + w) / 2, (y * 2 + h) / 2);
  }

  function drawBox(x, y, size, symbol, negate) {
    drawRect(x, y, size, size, symbol, negate);
  }

  function drawDot(x, y) {
    context.beginPath();
    let r = 2.5;
    context.arc(x, y, r, 0, 2 * Math.PI);
    context.fill();
  }

  function draw(canvas, context) {
    let ioWidth = 30;
    let ioHeight = 20;
    let xorSize = 40;
    let andSize = 30;
    let offset = 100;
    let origin = {x: 1, y: 1};
    
    let lineOrigin = origin.x + ioWidth;
    let andYOffset = origin.y + ioHeight * 1.5 * 2 - xorSize * 0.5;
            
    // inputs 1
    let syndrome1 = {x: origin.x, y: origin.y};
    drawRect(syndrome1.x, syndrome1.y, ioWidth, ioHeight, "s4");
    
    let inputs = ["s4", "s2", "s1"];
    
    for (let i = 0; i < 3; i++) {
    	let pos = {x: origin.x, y: origin.y + ioHeight * 1.5 * i};
      let xTopRight = lineOrigin + offset * 0.42 + offset * 0.13 * (3 - i);
      let xTopLeft = 0.4 * offset - offset * 0.12 * i; 
      
      drawRect(pos.x, pos.y, ioWidth, ioHeight, inputs[i]);
      
      context.beginPath();
      context.moveTo(pos.x + ioWidth, pos.y + ioHeight / 2);
      context.lineTo(xTopRight, pos.y + ioHeight / 2);
			context.lineTo(xTopRight, origin.y + ioHeight * 8 + xorSize * 0.75 + andYOffset);
      context.stroke();
      
      context.beginPath();
      for (let j = 0; j < 4; j++) {
      	let quarterY = origin.y + 0.5 * ioHeight * (5 * j + 1) + andYOffset + xorSize * (i + 1) / 4;
      
      	if (j == i + 1) {
        	context.beginPath();
          context.moveTo(lineOrigin + offset, quarterY);
          context.lineTo(lineOrigin + xTopLeft, quarterY);
          context.lineTo(lineOrigin + xTopLeft, pos.y + ioHeight * 0.5);
          context.stroke();
          drawDot(lineOrigin + xTopLeft, pos.y + ioHeight * 0.5);
        	continue;
        }
        
        context.beginPath();
        context.moveTo(xTopRight, quarterY);
        drawDot(xTopRight, quarterY);
        context.lineTo(lineOrigin + offset, quarterY);
        context.stroke();
      }
    }

    let outputs = ["d7", "d6", "d5", "d3"];
    let in2Height = origin.y + ioHeight * 3.5 * 2.5 + xorSize * 2;
    
    for (let i = 0; i < 4; i++) {
      let and = {x: lineOrigin + offset, y: origin.y + ioHeight * i * 2.5 + ioHeight / 2 + andYOffset};
      drawBox(and.x, and.y, xorSize, "&");

      let xorHeight = ioHeight * i * 2.5 + xorSize / 2 + andYOffset;
      let xor = {x: lineOrigin + xorSize + offset * 2, y: origin.y + xorHeight};
      drawBox(xor.x, xor.y, xorSize, "=1");

      let out = {x: lineOrigin + andSize + offset * 3.25, y: xorHeight + ioHeight / 2};
      drawRect(out.x, out.y, ioWidth, ioHeight, outputs[i]);
      
      context.beginPath();
      context.moveTo(and.x + xorSize, and.y + xorSize / 2);
      context.lineTo(and.x + xorSize + offset, and.y + xorSize / 2);
      context.stroke();

			// andToOut
      context.beginPath();
      context.moveTo(lineOrigin + xorSize + offset * 2 + xorSize, origin.y + xorHeight + xorSize / 2);
      context.lineTo(lineOrigin + andSize + offset * 3.25, origin.y + xorHeight + xorSize / 2);
      context.stroke();
    }
        
    // inputs 2
    for (let i = 0; i < 4; i++) {
      let h = in2Height + ioHeight * 1.5 * i;
      let smallOffset = offset * 0.25;
      let x1 = lineOrigin + offset + xorSize + smallOffset;;
      let x2 = x1 + offset - smallOffset * 2;

      drawRect(origin.x, h, ioWidth, ioHeight * 1, outputs[i]);

      context.beginPath();
      context.moveTo(lineOrigin, h + ioHeight / 2);
      context.lineTo(x1, h + ioHeight / 2);
      context.stroke();

      let currentPoint = {x: x1 + (x2 - x1) * i * 1 / 3, y: h + ioHeight / 2};
      let lineHeight = origin.y + ioHeight * i * 2.5 + xorSize / 2 + andYOffset + xorSize * 2 / 3;

      context.beginPath();
      context.moveTo(x1, h + ioHeight / 2);
      context.lineTo(currentPoint.x , currentPoint.y);
      context.stroke();

      context.beginPath();
      context.moveTo(x1, h + ioHeight / 2);
      context.lineTo(currentPoint.x, currentPoint.y);
      context.lineTo(currentPoint.x, lineHeight);
      context.lineTo(lineOrigin + offset * 2 + xorSize, lineHeight);
      context.stroke();
    }
  }

  draw(canvas, context);

  this.repaint = function() {
    draw(canvas, context);
  }

  return this;
}
</script>
</head>
<body>
  <canvas width="500" height="500" id="mycanvas"></canvas>
  <script>
    var demo = new hamming_coder_canvas("mycanvas");
  </script>
</body>
</html>